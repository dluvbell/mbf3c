<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBF3C - Unit 5: Statistics</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --bg-color: #f4f6f7;
            --card-bg: #ffffff;
            --border-radius: 8px;
            --money-color: #d35400;
            --money-bg: #fff5e6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #333;
            line-height: 1.6;
        }

        /* Navigation */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
        }

        nav {
            display: flex;
            justify-content: center;
            background-color: #34495e;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav button {
            background: none;
            border: none;
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
            border-bottom: 3px solid transparent;
        }

        nav button:hover, nav button.active {
            background-color: var(--accent-color);
            border-bottom: 3px solid white;
        }
        
        .home-btn { background-color: #e67e22 !important; }

        /* Content Structure */
        main {
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .tab-content {
            display: none;
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Lesson Accordion */
        .accordion {
            background-color: #eee;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .accordion:first-child { border-top-left-radius: var(--border-radius); border-top-right-radius: var(--border-radius); }
        .accordion:last-of-type { border-bottom-left-radius: var(--border-radius); border-bottom-right-radius: var(--border-radius); }

        .active-acc, .accordion:hover {
            background-color: #ccc;
        }

        .accordion:after {
            content: '\002B';
            font-weight: bold;
            font-size: 1.2rem;
        }

        .active-acc:after {
            content: "\2212";
        }

        .panel {
            padding: 0 18px;
            background-color: white;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            border-left: 5px solid var(--accent-color);
        }

        .example-box {
            background-color: #f0f3f4;
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin: 15px 0;
        }
        
        .example-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
            display: block;
        }

        .money-box {
            background-color: var(--money-bg);
            border: 2px solid var(--money-color);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.95rem;
        }
        .money-header {
            color: var(--money-color);
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Math Formatting */
        .math-text {
            font-family: 'Times New Roman', serif;
            font-size: 1.15rem;
            font-style: italic;
        }
        sup {
            font-size: 0.8em;
            vertical-align: super;
        }

        /* Practice Section */
        .practice-controls {
            background: #ecf0f1;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 1px solid #bdc3c7;
        }

        select, input[type="text"], input[type="number"] {
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 1rem;
            width: 100%;
            max-width: 400px;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
        }
        .btn-primary:hover { background-color: #2980b9; }

        .score-board {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.2rem;
            float: right;
            margin-top: 10px;
        }

        #question-area {
            margin: 20px 0;
            padding: 30px;
            border: 2px dashed #bdc3c7;
            border-radius: var(--border-radius);
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.3rem;
            font-weight: 500;
        }

        #feedback-area {
            font-weight: bold;
            margin-top: 15px;
            min-height: 24px;
            font-size: 1.1rem;
        }

        .correct { color: var(--success-color); }
        .incorrect { color: var(--error-color); }

        /* Print Button */
        .print-btn { background-color: #7f8c8d; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 0.8rem; margin-top: 10px; float: right; }
        
        /* Assignment Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th { background-color: var(--primary-color); color: white; }

        /* Assignment Task Box */
        .task-box {
            border-left: 5px solid var(--accent-color);
            background: #fdfdfd;
            padding: 15px;
            margin-bottom: 20px;
        }
        .task-step {
            font-weight: bold;
            color: var(--accent-color);
            text-transform: uppercase;
            font-size: 0.9rem;
            margin-bottom: 5px;
            display: block;
        }

        /* --- HISTOGRAM CHART STYLES (Fixed) --- */
        .histogram-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-between; /* Evenly distribute bins */
            height: 200px;
            border-bottom: 2px solid #333;
            border-left: 2px solid #333;
            padding: 0 10px 10px 10px; /* Padding for labels */
            margin: 20px auto;
            width: 80%;
            background-color: #fff;
            box-sizing: border-box;
        }

        .hist-bin {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            flex: 1; /* Key for Histogram: Equal width, filling space */
            height: 100%;
            margin: 0; /* Key: No gaps between bars */
            position: relative;
        }

        .hist-bar {
            width: 100%; /* Fill the bin */
            background-color: var(--accent-color);
            color: white;
            font-size: 0.9rem;
            text-align: center;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            border-right: 1px solid white; /* Thin separator visually */
            transition: height 0.5s ease;
            box-sizing: border-box;
        }
        /* Remove border for last bar */
        .hist-bin:last-child .hist-bar {
            border-right: none;
        }

        .hist-label {
            margin-top: 5px;
            font-size: 0.8rem;
            color: #555;
            position: absolute;
            bottom: -25px;
            width: 100%;
            text-align: center;
        }

        .hist-value {
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* --- MOBILE OPTIMIZATION --- */
        @media (max-width: 600px) {
            nav { flex-direction: column; }
            nav button { width: 100%; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 12px; }
            table { display: block; overflow-x: auto; white-space: nowrap; }
            .histogram-container { width: 100%; }
        }
    </style>
</head>
<body>

<header>
    <h1>MBF3C Unit 5: Statistics</h1>
    <p>Ontario Curriculum | College Preparation</p>
</header>

<nav>
    <button class="home-btn" onclick="window.location.href='index.html'">üè† Home</button>
    <button class="active" onclick="openTab('tab-calculator')">Calculator</button>
    <button onclick="openTab('tab-lessons')">Lessons</button>
    <button onclick="openTab('tab-practice')">Practice</button>
    <button onclick="openTab('tab-assignment')">Assignment</button>
</nav>

<main>
    <div id="tab-calculator" class="tab-content active">
        <h2>Statistics Calculator</h2>
        <p>Use this tool to calculate Mean, Median, Mode, and more. Enter numbers separated by commas.</p>
        <button class="btn-primary" onclick="window.open('https://www.calculator.net/statistics-calculator.html', '_blank')">Open Calculator in New Tab</button>
        <br><br>
        <iframe src="https://www.calculator.net/statistics-calculator.html?array=15%2C+20%2C+25%2C+30%2C+35&x=64&y=16" width="100%" height="800" frameborder="0"></iframe>
    </div>

    <div id="tab-lessons" class="tab-content">
        <h2>Unit 5 Lessons</h2>
        <p>Statistics is the science of learning from data. It helps us find the "truth" hidden in the numbers.</p>

        <button class="accordion">5.1 Mean, Median, Mode (Central Tendency)</button>
        <div class="panel">
            <button class="print-btn" onclick="printLesson(this)">üìÑ Print</button>
            <h3>Concept Overview</h3>
            <p>We use these three measures to find the "center" or "typical" value of a dataset.</p>
            <ul>
                <li><strong>Mean (<span class="math-text">xÃÑ</span>):</strong> The average. (Sum of values &div; Count).</li>
                <li><strong>Median:</strong> The middle number when sorted from lowest to highest.</li>
                <li><strong>Mode:</strong> The number that appears most often.</li>
            </ul>
            
            <h3>4 Examples</h3>
            <div class="example-box">
                <span class="example-title">Ex 1: Test Scores</span>
                Data: {70, 75, 80, 80, 95}.<br>
                <strong>Mean:</strong> (70+75+80+80+95) &div; 5 = 80.<br>
                <strong>Median:</strong> 80 (Middle number).<br>
                <strong>Mode:</strong> 80 (Appears twice).
            </div>
            <div class="example-box">
                <span class="example-title">Ex 2: The "Billionaire" Effect (Outliers)</span>
                Data (Annual Income): {30k, 30k, 30k, 30k, <strong>$10 Million</strong>}.<br>
                <strong>Mean:</strong> $2,024,000 (Very misleading!).<br>
                <strong>Median:</strong> $30,000 (Typical person).<br>
                <em>Lesson: Use Median when there are extreme outliers.</em>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 3: Shoe Sizes</span>
                Data: {7, 7, 7, 8, 9, 10, 11, 12}.<br>
                <strong>Mode:</strong> 7.<br>
                <em>Lesson: Mode is useful for inventory (stocking the most popular size).</em>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 4: Median with Even Numbers</span>
                Data: {2, 5, 8, 10}. (4 numbers).<br>
                Middle two are 5 and 8.<br>
                <strong>Median:</strong> (5 + 8) &div; 2 = 6.5.
            </div>

            <div class="money-box">
                <div class="money-header">üí∏ Money Connection: "Average" Salary</div>
                <p>When news reports say the "Average" salary is $60,000, be careful. A few CEOs making millions pull that average up. Always ask for the <strong>Median</strong> salary to know what a "normal" person actually makes.</p>
            </div>
        </div>

        <button class="accordion">5.2 Range and Outliers</button>
        <div class="panel">
            <button class="print-btn" onclick="printLesson(this)">üìÑ Print</button>
            <h3>Concept Overview</h3>
            <p>Measures of "Spread" tell us how consistent the data is.</p>
            <ul>
                <li><strong>Range:</strong> <span class="math-text">Max Value - Min Value</span>.</li>
                <li><strong>Outlier:</strong> A value much higher or lower than the rest.</li>
            </ul>
            
            <h3>4 Examples</h3>
            <div class="example-box">
                <span class="example-title">Ex 1: Daily Temperatures</span>
                City A: {20, 22, 21, 23, 22}. Range = 3 (Consistent).<br>
                City B: {10, 30, 5, 35, 20}. Range = 30 (Wild weather).
            </div>
            <div class="example-box">
                <span class="example-title">Ex 2: House Prices (Range)</span>
                Street A: $500k to $550k. Range = $50k.<br>
                Street B: $300k to $2.5M. Range = $2.2M.<br>
                Street B is a "mixed" neighborhood.
            </div>
            <div class="example-box">
                <span class="example-title">Ex 3: Consistency in Sports</span>
                Player A scores: {15, 15, 15, 15}. Range = 0.<br>
                Player B scores: {0, 30, 0, 30}. Range = 30.<br>
                Coaches usually prefer consistent players (Low Range).
            </div>
            <div class="example-box">
                <span class="example-title">Ex 4: Identifying Outliers</span>
                Data: {4, 5, 6, 5, 105}.<br>
                105 is clearly an outlier. It ruins the Mean but doesn't hurt the Median much.
            </div>

            <div class="money-box">
                <div class="money-header">üí∏ Money Connection: Risk</div>
                <p>In investing, <strong>Range</strong> represents <strong>Risk</strong>. A bank account has a range of 0% (Safe). Cryptocurrency has a huge range (High Risk). High range means you could win big or lose big.</p>
            </div>
        </div>

        <button class="accordion">5.3 Histograms (Visualizing Data)</button>
        <div class="panel">
            <button class="print-btn" onclick="printLesson(this)">üìÑ Print</button>
            <h3>Concept Overview</h3>
            <p>A Histogram uses bars to show the <strong>frequency</strong> of data in intervals (bins). <strong>Key Rule: The bars must touch</strong> (no gaps) because the data is continuous (like time, height, or money).</p>
            
            <h3>Visual Examples</h3>
            <div class="example-box">
                <span class="example-title">Ex 1: Normal Distribution (Bell Curve)</span>
                <p>Most data is in the middle (e.g., Average Grades). Frequencies: 5, 20, 35, 20, 5.</p>
                

[Image of Normal Distribution Curve]

                <div class="histogram-container">
                    <div class="hist-bin"><div class="hist-bar" style="height: 14%;"><span class="hist-value">5</span></div><div class="hist-label">F</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 57%;"><span class="hist-value">20</span></div><div class="hist-label">D</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 100%;"><span class="hist-value">35</span></div><div class="hist-label">C</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 57%;"><span class="hist-value">20</span></div><div class="hist-label">B</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 14%;"><span class="hist-value">5</span></div><div class="hist-label">A</div></div>
                </div>
            </div>
            
            <div class="example-box">
                <span class="example-title">Ex 2: Right Skewed (Real Estate)</span>
                <p>Most houses are affordable, a few are ultra-rich. Frequencies: 50, 30, 15, 5.</p>
                <div class="histogram-container">
                    <div class="hist-bin"><div class="hist-bar" style="height: 100%;"><span class="hist-value">50</span></div><div class="hist-label">Low</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 60%;"><span class="hist-value">30</span></div><div class="hist-label">Med</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 30%;"><span class="hist-value">15</span></div><div class="hist-label">High</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 10%;"><span class="hist-value">5</span></div><div class="hist-label">Ultra</div></div>
                </div>
            </div>

            <div class="example-box">
                <span class="example-title">Ex 3: Bimodal (Two Groups)</span>
                <p>Two separate peaks. Frequencies: 30, 5, 10, 30.</p>
                <div class="histogram-container">
                    <div class="hist-bin"><div class="hist-bar" style="height: 100%;"><span class="hist-value">30</span></div><div class="hist-label">Grp 1</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 16%;"><span class="hist-value">5</span></div><div class="hist-label">Gap</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 33%;"><span class="hist-value">10</span></div><div class="hist-label">Gap</div></div>
                    <div class="hist-bin"><div class="hist-bar" style="height: 100%;"><span class="hist-value">30</span></div><div class="hist-label">Grp 2</div></div>
                </div>
            </div>

            <div class="money-box">
                <div class="money-header">üí∏ Money Connection: Spending Habits</div>
                <p>If you made a histogram of your monthly expenses, you'd likely see many small bars for coffee/snacks (High Frequency, Low Cost) and one or two bars for Rent/Car (Low Frequency, High Cost).</p>
            </div>
        </div>
    </div>

    <div id="tab-practice" class="tab-content">
        <h2>Practice Problems</h2>
        
        <div class="practice-controls">
            <label for="practice-selector" style="font-weight:bold; display:block; margin-bottom:10px;">Select Topic:</label>
            <select id="practice-selector" onchange="resetPracticeUI()">
                <option value="" disabled selected>-- Choose a Topic --</option>
                <optgroup label="Calculations">
                    <option value="mean">Calculate Mean (Average)</option>
                    <option value="median">Calculate Median (Middle)</option>
                    <option value="mode">Calculate Mode (Most Frequent)</option>
                    <option value="range">Calculate Range (Max - Min)</option>
                </optgroup>
                <optgroup label="Analysis">
                    <option value="outlier">Identify the Outlier</option>
                    <option value="histogram_read">Interpret Histogram</option>
                    <option value="missing">Find the Missing Number (Challenge)</option>
                </optgroup>
                <option value="all">All in One (Random Mix)</option>
            </select>

            <button class="btn-primary" style="margin-top: 15px;" onclick="generateQuestion()">Generate Question</button>
            <div class="score-board">Score: <span id="score-display">0</span></div>
        </div>

        <div id="question-area">
            <p>Select a topic to begin.</p>
        </div>

        <div id="input-area" style="text-align: center; margin-top: 20px; display:none;">
            <input type="text" id="user-answer" placeholder="Enter answer (numbers only)">
            <button class="btn-primary" onclick="checkAnswer()">Check Answer</button>
        </div>
        
        <div id="feedback-area"></div>
    </div>

    <div id="tab-assignment" class="tab-content">
        <h2>Unit 5 Assignment: "The Real Estate Reality Check"</h2>
        <p><strong>Objective:</strong> You will act as a Data Analyst. You will collect real data, calculate statistics, and <strong>Create a Histogram</strong> to visualize the market.</p>
        <p><strong>Instructions:</strong> Complete the following sections in a separate report. Submit your findings to your teacher.</p>

        <div class="money-box">
            <div class="money-header">üíº Scenario</div>
            <p>A client wants to buy a house in your city. They heard the "Average" price is $800,000, but they see many cheaper houses. Help them understand the data using Mean, Median, and Graphs.</p>
        </div>

        <div class="task-box">
            <span class="task-step">Part A: Data Mining (Inquiry)</span>
            <p>1. Go to <strong>Realtor.ca</strong> (or a local listing site).</p>
            <p>2. Find <strong>10 different house prices</strong> in one city. (e.g., Barrie, ON).</p>
            <p>3. List your 10 prices in your report.</p>
        </div>

        <div class="task-box">
            <span class="task-step">Part B: Running the Stats (Application)</span>
            <p>Using your 10 prices:</p>
            <p>1. Calculate the <strong>Mean (Average)</strong>.</p>
            <p>2. Calculate the <strong>Median</strong>.</p>
            <p>3. Calculate the <strong>Range</strong>.</p>
        </div>

        <div class="task-box">
            <span class="task-step">Part C: The "Mansion" Effect (Analysis)</span>
            <p>1. Imagine a celebrity moves in next door. Add an 11th house to your list worth <strong>$10,000,000</strong>.</p>
            <p>2. Recalculate the <strong>New Mean</strong> with 11 houses.</p>
            <p>3. Recalculate the <strong>New Median</strong> with 11 houses.</p>
            <p>4. <strong>Compare:</strong> Which number changed more? The Mean or the Median? Why?</p>
        </div>

        <div class="task-box">
            <span class="task-step">Part D: Visualization (Communication)</span>
            <p><strong>Draw the histogram</strong> using your 11 house prices (including the mansion).</p>
            <p>1. Create 3-4 Price Intervals (Bins). Example: [0-500k], [500k-1M], [1M-2M], [2M+].</p>
            <p>2. Count how many houses fall into each bin (Frequency).</p>
            <p>3. Draw the histogram by hand or using technology and paste it into your report. <strong>Ensure bars touch!</strong></p>
        </div>

        <div class="task-box">
            <span class="task-step">Part E: The Report (Communication)</span>
            <p>Write a conclusion for your client:</p>
            <ul>
                <li>"Based on my analysis, the 'typical' price is $________ (Mean or Median)."</li>
                <li>Explain <strong>WHY</strong> you chose Mean or Median based on your data shape (especially with the mansion outlier).</li>
            </ul>
        </div>

        <h3>Assessment Rubric (Growing Success)</h3>
        <table style="font-size: 0.9rem;">
            <thead>
                <tr>
                    <th style="width: 20%;">Category</th>
                    <th style="width: 20%;">Level 1 (50-59%)</th>
                    <th style="width: 20%;">Level 2 (60-69%)</th>
                    <th style="width: 20%;">Level 3 (70-79%)</th>
                    <th style="width: 20%;">Level 4 (80-100%)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Knowledge</strong></td>
                    <td>Calculations contain frequent errors.</td>
                    <td>Calculations are mostly correct.</td>
                    <td>Calculations of Mean/Median are correct.</td>
                    <td>Calculations are precise and verified.</td>
                </tr>
                <tr>
                    <td><strong>Inquiry</strong></td>
                    <td>Data gathered is insufficient (fewer than 10 houses).</td>
                    <td>Data is gathered but variety is limited.</td>
                    <td>Data is gathered correctly from real sources.</td>
                    <td>Data is diverse, realistic, and well-organized.</td>
                </tr>
                <tr>
                    <td><strong>Application</strong></td>
                    <td>Difficulty recalculating stats with the outlier.</td>
                    <td>Recalculates stats with some errors.</td>
                    <td>Correctly recalculates stats to show the outlier effect.</td>
                    <td>Perfectly demonstrates the impact of outliers (The Mansion) on data.</td>
                </tr>
                <tr>
                    <td><strong>Communication</strong></td>
                    <td>Histogram is missing or resembles a bar graph (gaps).</td>
                    <td>Histogram is present but lacks labels.</td>
                    <td>Histogram correctly represents the data (touching bars).</td>
                    <td>Histogram is professional, accurate, and enhances the report.</td>
                </tr>
            </tbody>
        </table>
    </div>
</main>

<script>
    // --- State Management ---
    let currentScore = 0;
    
    // --- Navigation ---
    function openTab(tabId) {
        const contents = document.getElementsByClassName('tab-content');
        for (let content of contents) content.classList.remove('active');
        document.getElementById(tabId).classList.add('active');
        const navBtns = document.querySelectorAll('nav button');
        navBtns.forEach(btn => btn.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    // --- Accordion ---
    const acc = document.getElementsByClassName("accordion");
    for (let i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function() {
            this.classList.toggle("active-acc");
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight) panel.style.maxHeight = null;
            else panel.style.maxHeight = panel.scrollHeight + "px";
        });
    }

    function printLesson(btn) {
        alert("Printing functionality would open a system dialog here.");
        window.print();
    }

    // --- Helpers ---
    function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    function randChoice(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
    function formatMoney(num) { return '$' + num.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,'); }

    // --- Main Logic: Generate Question ---
    function resetPracticeUI() {
        document.getElementById('feedback-area').innerHTML = "";
        document.getElementById('question-area').innerHTML = "<p>Click 'Generate Question' to start.</p>";
        document.getElementById('input-area').style.display = 'none';
        currentScore = 0;
        document.getElementById('score-display').innerText = currentScore;
    }

    let currentQuestion = null;

    function generateQuestion() {
        const selector = document.getElementById('practice-selector');
        let val = selector.value;
        const qArea = document.getElementById('question-area');
        const inputArea = document.getElementById('input-area');
        const feedback = document.getElementById('feedback-area');

        // Reset
        feedback.innerText = ""; feedback.className = "";
        document.getElementById('user-answer').value = "";
        inputArea.style.display = 'block';

        // All in One Handler
        if (val === 'all') {
            const options = ['mean', 'median', 'mode', 'range', 'outlier', 'missing', 'histogram_read'];
            val = randChoice(options);
        }

        // Generate Dataset (Infinite Pool)
        const size = randChoice([5, 7, 9]); 
        let data = [];
        for(let i=0; i<size; i++) data.push(randInt(1, 20));
        
        // Router
        if (val === 'mean') genMean(qArea, data);
        else if (val === 'median') genMedian(qArea, data);
        else if (val === 'mode') genMode(qArea); 
        else if (val === 'range') genRange(qArea, data);
        else if (val === 'outlier') genOutlier(qArea);
        else if (val === 'missing') genMissing(qArea);
        else if (val === 'histogram_read') genHistogramRead(qArea);
    }

    // --- 1. Mean ---
    function genMean(qArea, data) {
        let sum = data.reduce((a,b)=>a+b, 0);
        let remainder = sum % data.length;
        if(remainder !== 0) {
            data[0] += (data.length - remainder); 
        }
        sum = data.reduce((a,b)=>a+b, 0);
        const ans = sum / data.length;
        
        qArea.innerHTML = `
            <p>Data Set: <strong>{ ${data.join(', ')} }</strong></p>
            <p>Calculate the <strong>Mean</strong> (<span class="math-text">xÃÑ</span>).</p>
            <p><small>(Sum &div; Count)</small></p>
        `;
        currentQuestion = { answer: ans, type: 'numeric' };
    }

    // --- 2. Median ---
    function genMedian(qArea, data) {
        let sorted = [...data].sort((a,b) => a-b);
        let mid = Math.floor(sorted.length / 2);
        const ans = sorted[mid];

        qArea.innerHTML = `
            <p>Data Set: <strong>{ ${data.join(', ')} }</strong></p>
            <p>Calculate the <strong>Median</strong>.</p>
            <p><small>(Don't forget to order them first!)</small></p>
        `;
        currentQuestion = { answer: ans, type: 'numeric' };
    }

    // --- 3. Mode ---
    function genMode(qArea) {
        let data = [randInt(1,10), randInt(1,10), randInt(1,10)];
        const target = randInt(11, 20);
        data.push(target, target, target);
        data.sort(() => Math.random() - 0.5);
        
        qArea.innerHTML = `
            <p>Data Set: <strong>{ ${data.join(', ')} }</strong></p>
            <p>Identify the <strong>Mode</strong>.</p>
            <p><small>(The most frequent number)</small></p>
        `;
        currentQuestion = { answer: target, type: 'numeric' };
    }

    // --- 4. Range ---
    function genRange(qArea, data) {
        let min = Math.min(...data);
        let max = Math.max(...data);
        const ans = max - min;

        qArea.innerHTML = `
            <p>Data Set: <strong>{ ${data.join(', ')} }</strong></p>
            <p>Calculate the <strong>Range</strong>.</p>
            <p><small>(Max - Min)</small></p>
        `;
        currentQuestion = { answer: ans, type: 'numeric' };
    }

    // --- 5. Outlier ---
    function genOutlier(qArea) {
        let data = [10, 12, 11, 13, 12];
        let outlier = randInt(50, 100);
        data.push(outlier);
        data.sort(() => Math.random() - 0.5);

        qArea.innerHTML = `
            <p>Data Set: <strong>{ ${data.join(', ')} }</strong></p>
            <p>Which number is the <strong>Outlier</strong>?</p>
        `;
        currentQuestion = { answer: outlier, type: 'numeric' };
    }

    // --- 6. Missing Number (3 to 5 items) ---
    function genMissing(qArea) {
        // Random count between 3 and 5
        const count = randInt(3, 5);
        const targetMean = randInt(5, 15);
        const totalNeeded = targetMean * count;
        
        // Generate count-1 numbers
        let knownNumbers = [];
        let currentSum = 0;
        for(let i=0; i < count - 1; i++) {
            let n = randInt(1, targetMean + 5);
            knownNumbers.push(n);
            currentSum += n;
        }
        
        // The missing number
        const nMissing = totalNeeded - currentSum;

        qArea.innerHTML = `
            <p>The <strong>Mean</strong> of ${count} numbers is <strong>${targetMean}</strong>.</p>
            <p>The known numbers are: <strong>${knownNumbers.join(', ')}</strong>.</p>
            <p>What is the missing number?</p>
            <p><small>Hint: Total Sum must be ${count} &times; ${targetMean} = ${totalNeeded}</small></p>
        `;
        currentQuestion = { answer: nMissing, type: 'numeric' };
    }

    // --- 7. Interpret Histogram (Visual Fix) ---
    function genHistogramRead(qArea) {
        const h1 = randInt(2, 10);
        const h2 = randInt(10, 25); 
        const h3 = randInt(5, 15);
        const h4 = randInt(1, 8);
        
        // Max height for scaling (25 is max random above)
        const scale = 180 / 25; 

        const type = Math.random() > 0.5 ? 'count' : 'max';
        let qText = "";
        let ans = 0;

        if (type === 'count') {
            qText = "How many people are in the <strong>[20-30]</strong> age group?";
            ans = h2;
        } else {
            qText = "What is the frequency of the <strong>[40-50]</strong> group?";
            ans = h4;
        }

        let chartHTML = `
            <div class="histogram-container" style="height:200px; width:100%;">
                <div class="hist-bin"><div class="hist-bar" style="height: ${h1*scale}px;"><span class="hist-value">${h1}</span></div><div class="hist-label">10-20</div></div>
                <div class="hist-bin"><div class="hist-bar" style="height: ${h2*scale}px;"><span class="hist-value">${h2}</span></div><div class="hist-label">20-30</div></div>
                <div class="hist-bin"><div class="hist-bar" style="height: ${h3*scale}px;"><span class="hist-value">${h3}</span></div><div class="hist-label">30-40</div></div>
                <div class="hist-bin"><div class="hist-bar" style="height: ${h4*scale}px;"><span class="hist-value">${h4}</span></div><div class="hist-label">40-50</div></div>
            </div>
        `;

        qArea.innerHTML = `
            <p>Look at the Histogram below (Age Groups). Note: Bars touch because age is continuous.</p>
            ${chartHTML}
            <p>${qText}</p>
        `;
        currentQuestion = { answer: ans, type: 'numeric' };
    }

    // --- Check Answer ---
    function checkAnswer() {
        if (!currentQuestion) return;
        
        let userRaw = document.getElementById('user-answer').value.replace(/[\$,]/g, '').trim();
        let userVal = parseFloat(userRaw);
        let feedback = document.getElementById('feedback-area');
        
        if (isNaN(userVal)) {
            feedback.innerHTML = "Please enter a valid number.";
            feedback.className = "";
            return;
        }

        let isCorrect = false;
        let correctVal = currentQuestion.answer;
        const margin = 0.1;

        if (Math.abs(userVal - correctVal) <= margin) {
            isCorrect = true;
        }

        if (isCorrect) {
            feedback.innerHTML = "Correct!";
            feedback.className = "correct";
            currentScore++;
            document.getElementById('score-display').innerText = currentScore;
        } else {
            feedback.innerHTML = "Incorrect. Try again.";
            feedback.className = "incorrect";
        }
    }

    // Init
    generateQuestion();

</script>
</body>
</html>