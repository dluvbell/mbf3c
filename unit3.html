<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBF3C - Unit 3: Exponential Relations</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --bg-color: #f4f6f7;
            --card-bg: #ffffff;
            --border-radius: 8px;
            --money-color: #d35400;
            --money-bg: #fff5e6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #333;
            line-height: 1.6;
        }

        /* Navigation */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
        }

        nav {
            display: flex;
            justify-content: center;
            background-color: #34495e;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav button {
            background: none;
            border: none;
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
            border-bottom: 3px solid transparent;
        }

        nav button:hover, nav button.active {
            background-color: var(--accent-color);
            border-bottom: 3px solid white;
        }

        .home-btn { background-color: #e67e22 !important; }

        /* Content Structure */
        main {
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .tab-content {
            display: none;
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Lesson Accordion */
        .accordion {
            background-color: #eee;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .accordion:first-child { border-top-left-radius: var(--border-radius); border-top-right-radius: var(--border-radius); }
        .accordion:last-of-type { border-bottom-left-radius: var(--border-radius); border-bottom-right-radius: var(--border-radius); }

        .active-acc, .accordion:hover {
            background-color: #ccc;
        }

        .accordion:after {
            content: '\002B';
            font-weight: bold;
            font-size: 1.2rem;
        }

        .active-acc:after {
            content: "\2212";
        }

        .panel {
            padding: 0 18px;
            background-color: white;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            border-left: 5px solid var(--accent-color);
        }

        .example-box {
            background-color: #f0f3f4;
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin: 15px 0;
        }
        
        .example-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
            display: block;
        }

        .money-box {
            background-color: var(--money-bg);
            border: 2px solid var(--money-color);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.95rem;
        }
        .money-header {
            color: var(--money-color);
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Math Formatting */
        .math-text {
            font-family: 'Times New Roman', serif;
            font-size: 1.15rem;
            font-style: italic;
        }
        sup {
            font-size: 0.8em;
            vertical-align: super;
        }

        /* Practice Section */
        .practice-controls {
            background: #ecf0f1;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 1px solid #bdc3c7;
        }

        select, input[type="text"], input[type="number"] {
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 1rem;
            width: 100%;
            max-width: 400px;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
        }
        .btn-primary:hover { background-color: #2980b9; }

        .score-board {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.2rem;
            float: right;
            margin-top: 10px;
        }

        #question-area {
            margin: 20px 0;
            padding: 30px;
            border: 2px dashed #bdc3c7;
            border-radius: var(--border-radius);
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.3rem;
            font-weight: 500;
        }

        #feedback-area {
            font-weight: bold;
            margin-top: 15px;
            min-height: 24px;
            font-size: 1.1rem;
        }

        .correct { color: var(--success-color); }
        .incorrect { color: var(--error-color); }

        /* Print Button */
        .print-btn { background-color: #7f8c8d; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 0.8rem; margin-top: 10px; float: right; }
        
        /* Assignment Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th { background-color: var(--primary-color); color: white; }

        /* --- MOBILE OPTIMIZATION --- */
        @media (max-width: 600px) {
            nav { flex-direction: column; }
            nav button { width: 100%; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 12px; }
            table { display: block; overflow-x: auto; white-space: nowrap; }
        }
        
        .version-tag { position: fixed; bottom: 5px; left: 5px; font-size: 0.7rem; color: #ccc; z-index: 9999; }
    </style>
</head>
<body>

<header>
    <h1>MBF3C Unit 3: Exponential Relations</h1>
    <p>Ontario Curriculum | College Preparation</p>
</header>

<nav>
    <button class="home-btn" onclick="window.location.href='index.html'">üè† Home</button>
    <button class="active" onclick="openTab('tab-calculator')">Calculator</button>
    <button onclick="openTab('tab-lessons')">Lessons</button>
    <button onclick="openTab('tab-practice')">Practice</button>
    <button onclick="openTab('tab-assignment')">Assignment</button>
</nav>

<main>
    <div id="tab-calculator" class="tab-content active">
        <h2>Compound Interest Calculator</h2>
        <p>Use this calculator to see how money grows over time (The 8th Wonder of the World).</p>
        <button class="btn-primary" onclick="window.open('https://www.calculator.net/interest-calculator.html', '_blank')">Open Calculator in New Tab</button>
        <br><br>
        <iframe src="https://www.calculator.net/interest-calculator.html?cstartingprinciple=1000&cannualaddition=100&cmonthlyaddition=0&cadditionat1=beginning&cinterestrate=7&ccompound=annually&cyears=10&ctaxtrate=0&cinflationrate=0&printit=0&x=115&y=22" width="100%" height="800" frameborder="0"></iframe>
    </div>

    <div id="tab-lessons" class="tab-content">
        <h2>Unit 3 Lessons</h2>
        <p>Understand how viruses spread, populations grow, and most importantly, how <strong>Money</strong> multiplies.</p>

        <button class="accordion">3.1 Exponent Laws (The Basics)</button>
        <div class="panel">
            <button class="print-btn" onclick="printLesson(this)">üìÑ Print</button>
            <h3>Concept Overview</h3>
            <p>Exponents represent repeated multiplication. In <span class="math-text">b<sup>x</sup></span>, <strong>b</strong> is the base and <strong>x</strong> is the exponent.</p>
            
            <h3>4 Examples</h3>
            <div class="example-box">
                <span class="example-title">Ex 1: Product Rule (Multiply)</span>
                Rule: <span class="math-text">x<sup>a</sup> &times; x<sup>b</sup> = x<sup>a+b</sup></span><br>
                Example: <span class="math-text">2<sup>3</sup> &times; 2<sup>4</sup> = 2<sup>7</sup></span> (Add exponents)
            </div>
            <div class="example-box">
                <span class="example-title">Ex 2: Quotient Rule (Divide)</span>
                Rule: <span class="math-text">x<sup>a</sup> &div; x<sup>b</sup> = x<sup>a-b</sup></span><br>
                Example: <span class="math-text">5<sup>6</sup> &div; 5<sup>2</sup> = 5<sup>4</sup></span> (Subtract exponents)
            </div>
            <div class="example-box">
                <span class="example-title">Ex 3: Power of a Power</span>
                Rule: <span class="math-text">(x<sup>a</sup>)<sup>b</sup> = x<sup>a &times; b</sup></span><br>
                Example: <span class="math-text">(3<sup>2</sup>)<sup>4</sup> = 3<sup>8</sup></span> (Multiply exponents)
            </div>
            <div class="example-box">
                <span class="example-title">Ex 4: Zero Exponent</span>
                Rule: <span class="math-text">x<sup>0</sup> = 1</span> (Always!)<br>
                Example: <span class="math-text">1,000,000<sup>0</sup> = 1</span>
            </div>

            <div class="money-box">
                <div class="money-header">üí∏ Money Connection: The Penny Problem</div>
                <p>Would you rather have $1 Million dollars today, or a penny that doubles every day for 30 days?</p>
                <p>Day 1: $0.01<br>Day 2: $0.02<br>...<br>Day 30: <span class="math-text">0.01 &times; 2<sup>29</sup></span> &approx; <strong>$5.3 Million!</strong></p>
            </div>
        </div>

        <button class="accordion">3.2 Exponential Growth (The J-Curve)</button>
        <div class="panel">
            <button class="print-btn" onclick="printLesson(this)">üìÑ Print</button>
            <h3>Concept Overview</h3>
            <p>Growth where the rate of increase speeds up. It creates a "J" shaped curve. <br>Formula: <span class="math-text">y = a(b)<sup>x</sup></span> (where b > 1)</p>
            
            <h3>4 Examples</h3>
            <div class="example-box">
                <span class="example-title">Ex 1: Bacteria Growth</span>
                Starts with 100, doubles every hour (b=2).<br>
                Eq: <span class="math-text">y = 100(2)<sup>x</sup></span>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 2: Inflation (Price Hike)</span>
                A burger costs $5. Inflation is 10% (0.10) per year.<br>
                Growth factor b = 1 + 0.10 = 1.10.<br>
                Eq: <span class="math-text">y = 5(1.10)<sup>x</sup></span>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 3: Real Estate</span>
                A condo worth $500k goes up 5% per year.<br>
                b = 1.05.<br>
                Eq: <span class="math-text">y = 500,000(1.05)<sup>x</sup></span>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 4: Viral Video</span>
                Views start at 1,000 and triple (b=3) every hour.<br>
                Eq: <span class="math-text">y = 1,000(3)<sup>x</sup></span>
            </div>

            <div class="money-box">
                <div class="money-header">üí∏ Money Connection: Rule of 72</div>
                <p>How long to double your money? Divide 72 by the interest rate.</p>
                <ul>
                    <li>Bank (2%): 72 &div; 2 = 36 years to double.</li>
                    <li>Stock Market (10%): 72 &div; 10 = 7.2 years to double.</li>
                </ul>
            </div>
        </div>

        <button class="accordion">3.3 Compound Interest (Making Money)</button>
        <div class="panel">
            <button class="print-btn" onclick="printLesson(this)">üìÑ Print</button>
            <h3>Concept Overview</h3>
            <p>Formula: <span class="math-text">A = P(1 + i)<sup>n</sup></span></p>
            <ul>
                <li><strong>A:</strong> Final Amount</li>
                <li><strong>P:</strong> Principal (Starting Money)</li>
                <li><strong>i:</strong> Interest rate (decimal)</li>
                <li><strong>n:</strong> Number of years/periods</li>
            </ul>
            
            <h3>4 Examples</h3>
            <div class="example-box">
                <span class="example-title">Ex 1: Savings Account</span>
                $1,000 at 5% for 3 years.<br>
                <span class="math-text">A = 1000(1.05)<sup>3</sup> = $1,157.63</span>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 2: GIC Investment</span>
                $5,000 locked for 10 years at 4%.<br>
                <span class="math-text">A = 5000(1.04)<sup>10</sup> = $7,401.22</span>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 3: Credit Card Debt (Danger)</span>
                $500 debt at 20% interest, ignored for 4 years.<br>
                <span class="math-text">A = 500(1.20)<sup>4</sup> = $1,036.80</span> (Debt doubled!)
            </div>
            <div class="example-box">
                <span class="example-title">Ex 4: High Growth</span>
                $2,000 in Tech ETF at 12% for 5 years.<br>
                <span class="math-text">A = 2000(1.12)<sup>5</sup> = $3,524.68</span>
            </div>

            <div class="money-box">
                <div class="money-header">üí∏ Money Connection: Start Early</div>
                <p><strong>Compound Interest loves Time.</strong> Investing $100/month starting at age 20 creates way more wealth than starting at age 40, even if the 40-year-old invests more money later. The exponent <strong>n</strong> is the most powerful variable.</p>
            </div>
        </div>

        <button class="accordion">3.4 Exponential Decay (Losing Value)</button>
        <div class="panel">
            <button class="print-btn" onclick="printLesson(this)">üìÑ Print</button>
            <h3>Concept Overview</h3>
            <p>When values drop by a percentage. The curve falls fast then flattens.<br>Formula: <span class="math-text">y = a(b)<sup>x</sup></span> (where 0 < b < 1)</p>
            
            <h3>4 Examples</h3>
            <div class="example-box">
                <span class="example-title">Ex 1: Car Depreciation</span>
                A $30,000 car loses 20% per year.<br>
                You keep 80%, so b = 0.80.<br>
                Eq: <span class="math-text">y = 30000(0.80)<sup>x</sup></span>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 2: Caffeine in Body</span>
                100mg coffee. Body removes 15% per hour (keeps 85%).<br>
                Eq: <span class="math-text">y = 100(0.85)<sup>x</sup></span>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 3: Tournament Bracket</span>
                64 Teams. Half (50%) eliminated each round.<br>
                b = 0.5.<br>
                Eq: <span class="math-text">y = 64(0.5)<sup>x</sup></span>
            </div>
            <div class="example-box">
                <span class="example-title">Ex 4: Buying Power (Inflation)</span>
                If inflation is 3%, your $100 bill loses value.<br>
                It is worth 97% of last year. b = 0.97.<br>
                Eq: <span class="math-text">y = 100(0.97)<sup>x</sup></span>
            </div>

            <div class="money-box">
                <div class="money-header">üí∏ Money Connection: The "New Car" Trap</div>
                <p>Cars are depreciating assets. A new car loses ~15% value the moment you drive it off the lot. Smart financial planning involves buying used cars to let someone else pay for that steep initial decay.</p>
            </div>
        </div>
    </div>

    <div id="tab-practice" class="tab-content">
        <h2>Practice Problems</h2>
        
        <div class="practice-controls">
            <label for="practice-selector" style="font-weight:bold; display:block; margin-bottom:10px;">Select Problem Type:</label>
            <select id="practice-selector" onchange="resetPracticeUI()">
                <option value="" disabled selected>-- Choose a Topic --</option>
                
                <optgroup label="Skills">
                    <option value="rules">Exponent Laws (Simplify)</option>
                    <option value="growth">Calculate Growth (y = ab^x)</option>
                    <option value="decay">Calculate Decay (Depreciation)</option>
                </optgroup>
                <optgroup label="Financial Literacy">
                    <option value="compound">Compound Interest (A = P(1+i)^n)</option>
                    <option value="rule72">Rule of 72 (Doubling Time)</option>
                    <option value="word">Word Problems (Real World)</option>
                </optgroup>
                <option value="all">All in One (Random Mix)</option>
            </select>

            <button class="btn-primary" style="margin-top: 15px;" onclick="generateQuestion()">Generate Question</button>
            <div class="score-board">Score: <span id="score-display">0</span></div>
        </div>

        <div id="question-area">
            <p>Please select a topic from the dropdown above to begin.</p>
        </div>

        <div id="input-area" style="text-align: center; margin-top: 20px; display:none;">
            <input type="text" id="user-answer" placeholder="Enter answer (numbers only)">
            <button class="btn-primary" onclick="checkAnswer()">Check Answer</button>
        </div>
        
        <div id="feedback-area"></div>
    </div>

    <div id="tab-assignment" class="tab-content">
        <h2>Unit 3 Assignment: The Personal Financial Plan</h2>
        <p><strong>Scenario:</strong> Instead of solving a generic textbook problem, you will apply the math to <strong>Your Own Life</strong>. This project requires you to research real-world data and plan your own financial future.</p>
        
        <div class="money-box">
            <div class="money-header">üíº Your Mission</div>
            <p>Create a personalized financial report ("The Dream & The Plan") using real data. No two students will have the same numbers!</p>
        </div>

        <h3>Part A: The Dream Car Reality (Depreciation)</h3>
        <p>Go to <strong>AutoTrader.ca</strong> or a similar site. Find a "Dream Car" you would actually like to buy in the future. It must be a specific listing (Year, Make, Model, Price).</p>
        <ol>
            <li><strong>Data Collection:</strong> Record the Name and Price (<span class="math-text">P</span>) of the car. Paste the link to the listing.</li>
            <li><strong>The Model:</strong> Assume an average depreciation rate of <strong>15% per year</strong> (You keep 85% value). Write your equation: <span class="math-text">y = P(0.85)<sup>x</sup></span>.</li>
            <li><strong>The Future:</strong> Calculate what this car will be worth in <strong>5 years</strong>.</li>
            <li><strong>The Cost of Ownership:</strong> Calculate exactly how much money "evaporated" in value over those 5 years. (Original Price - Future Value).</li>
        </ol>

        <h3>Part B: The "Cost of Waiting" (Compound Interest)</h3>
        <p>You will calculate the difference between starting your investments NOW vs. starting later. Use: <span class="math-text">A = P(1 + i)<sup>n</sup></span>.</p>
        <ol>
            <li><strong>Step 1: Determine P (Principal).</strong> How much could you realistically save from a summer job, gifts, or selling old items? (e.g., $1,000? $2,500? $500?). <strong>Write this number down as P.</strong></li>
            <li><strong>The Market:</strong> Assume you invest this P in the S&P 500 with an average return of <strong>10% per year</strong> (<span class="math-text">i = 0.10</span>).</li>
            <li><strong>The Race:</strong>
                <ul>
                    <li><strong>Scenario A (Start Now):</strong> Assume you are 17. Calculate the value when you turn <strong>60 years old</strong> (n = 43 years).</li>
                    <li><strong>Scenario B (Procrastinate):</strong> Assume you wait until you are <strong>30 years old</strong> to invest that same P. You calculate value at age 60 (n = 30 years).</li>
                </ul>
            </li>
            <li><strong>Reflection:</strong> Subtract Scenario B from Scenario A. This number is the "Price of Procrastination". Write a sentence about what you could buy with that lost money.</li>
        </ol>

        <h3>Grading Rubric (KICA)</h3>
        <table>
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Level 4 (80-100%)</th>
                    <th>Level 3 (70-79%)</th>
                    <th>Level 2 (60-69%)</th>
                    <th>Level 1 (50-59%)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Knowledge</strong></td>
                    <td>Calculations are 100% accurate based on <strong>your unique data</strong>.</td>
                    <td>Calculations are correct but may have minor rounding errors.</td>
                    <td>Calculations follow the formula but contain errors.</td>
                    <td>Formulas used incorrectly.</td>
                </tr>
                <tr>
                    <td><strong>Inquiry</strong></td>
                    <td>Real-world car choice is realistic. Chosen savings amount (P) is reasonable.</td>
                    <td>Real-world data is provided.</td>
                    <td>Data is missing or unrealistic.</td>
                    <td>No data collection evident.</td>
                </tr>
                <tr>
                    <td><strong>Communication</strong></td>
                    <td>Reflection on "The Cost of Waiting" is insightful, using math terms.</td>
                    <td>Reflection is clear and logical.</td>
                    <td>Reflection is brief or vague.</td>
                    <td>Reflection is missing.</td>
                </tr>
                <tr>
                    <td><strong>Application</strong></td>
                    <td>Connects the math perfectly to personal life goals.</td>
                    <td>Connects math to personal goals.</td>
                    <td>Weak connection to personal goals.</td>
                    <td>No connection made.</td>
                </tr>
            </tbody>
        </table>
    </div>
</main>

<div class="version-tag">v2.1 (Anti-Spam & Precision)</div>

<script>
    /* --- UTILS --- */
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const round = (n) => Math.round(n * 10) / 10;
    
    // --- State Management ---
    let currentScore = 0;
    let isQuestionSolved = false; // New Anti-Spam flag
    
    // --- Navigation ---
    function openTab(tabId) {
        const contents = document.getElementsByClassName('tab-content');
        for (let content of contents) content.classList.remove('active');
        document.getElementById(tabId).classList.add('active');
        const navBtns = document.querySelectorAll('nav button');
        navBtns.forEach(btn => btn.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    // --- Accordion ---
    const acc = document.getElementsByClassName("accordion");
    for (let i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function() {
            this.classList.toggle("active-acc");
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight) panel.style.maxHeight = null;
            else panel.style.maxHeight = panel.scrollHeight + "px";
        });
    }

    function printLesson(btn) {
        alert("Printing functionality would open a system dialog here.");
        window.print();
    }

    // --- Helpers ---
    function randInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function randChoice(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
    }
    function formatMoney(num) {
        return '$' + num.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
    }

    // --- Main Logic: Generate Question ---
    function resetPracticeUI() {
        document.getElementById('feedback-area').innerHTML = "";
        document.getElementById('question-area').innerHTML = "<p>Click 'Generate Question' to start.</p>";
        document.getElementById('input-area').style.display = 'none';
        
        currentScore = 0;
        document.getElementById('score-display').innerText = currentScore;
    }

    let currentQuestion = null;

    function generateQuestion() {
        const selector = document.getElementById('practice-selector');
        let val = selector.value;
        const qArea = document.getElementById('question-area');
        const inputArea = document.getElementById('input-area');
        const feedback = document.getElementById('feedback-area');

        // Reset
        feedback.innerText = ""; feedback.className = "";
        document.getElementById('user-answer').value = "";
        inputArea.style.display = 'block';
        
        // Anti-Spam Reset
        isQuestionSolved = false;

        // All in One Handler - Pick any generator
        if (val === 'all') {
            const options = ['rules', 'growth', 'decay', 'compound', 'rule72', 'word'];
            val = randChoice(options);
        }

        // Router
        if (val === 'rules') genRules(qArea);
        else if (val === 'growth') genGrowth(qArea);
        else if (val === 'decay') genDecay(qArea);
        else if (val === 'compound') genCompound(qArea);
        else if (val === 'rule72') genRule72(qArea);
        else if (val === 'word') genWordProblem(qArea);
    }

    // --- 1. Exponent Laws (Infinite Variations) ---
    function genRules(qArea) {
        const type = randInt(1, 4); // Added 4th type
        let qText = "";
        let ans = 0;

        if (type === 1) { // Product: x^a * x^b
            const base = randInt(2, 5);
            const a = randInt(2, 6);
            const b = randInt(2, 6);
            qText = `Simplify and Evaluate: <br><span class="math-text">${base}<sup>${a}</sup> &times; ${base}<sup>${b}</sup></span>`;
            ans = Math.pow(base, a + b);
        } else if (type === 2) { // Quotient: x^a / x^b
            const base = randInt(2, 6);
            const b = randInt(2, 4);
            const diff = randInt(1, 4);
            const a = b + diff; 
            qText = `Simplify and Evaluate: <br><span class="math-text">${base}<sup>${a}</sup> &div; ${base}<sup>${b}</sup></span>`;
            ans = Math.pow(base, diff);
        } else if (type === 3) { // Power: (x^a)^b
            const base = randInt(2, 4);
            const a = randInt(2, 3);
            const b = randInt(2, 3);
            qText = `Simplify and Evaluate: <br><span class="math-text">(${base}<sup>${a}</sup>)<sup>${b}</sup></span>`;
            ans = Math.pow(base, a * b);
        } else { // Zero Exponent (Tricky mix)
            const base = randInt(10, 100);
            const extra = randInt(2, 10);
            qText = `Simplify and Evaluate: <br><span class="math-text">${extra} &times; ${base}<sup>0</sup></span>`;
            ans = extra * 1; 
        }

        qArea.innerHTML = `<p>${qText}</p><p>What is the final number value?</p>`;
        currentQuestion = { answer: ans, type: 'numeric' };
    }

    // --- 2. Growth (Multiple Scenarios) ---
    function genGrowth(qArea) {
        // Scenarios for Growth
        const scenarios = [
            { name: "Bacteria Culture", start: [50, 200], rateType: "doubles", b: 2, tUnit: "hours" },
            { name: "Viral Video", start: [100, 1000], rateType: "triples", b: 3, tUnit: "hours" },
            { name: "Town Population", start: [1000, 10000], rateType: "grows 5%", b: 1.05, tUnit: "years" },
            { name: "Real Estate", start: [200000, 500000], rateType: "grows 10%", b: 1.10, tUnit: "years" },
            { name: "Investment", start: [500, 2000], rateType: "quadruples", b: 4, tUnit: "decades" }
        ];

        const s = randChoice(scenarios);
        const a = randInt(s.start[0], s.start[1]);
        const x = randInt(2, 5);
        
        // Adjust for percent scenarios
        let rateText = s.rateType;
        let bVal = s.b;
        if(s.rateType.includes("%")) {
             // For variety, randomize percent slightly if it's the percent type
             if(s.name === "Town Population") { 
                 const p = randInt(2, 8); 
                 bVal = 1 + (p/100); 
                 rateText = `grows by ${p}%`; 
             }
        }

        const ans = a * Math.pow(bVal, x);

        qArea.innerHTML = `
            <p><strong>Scenario: ${s.name}</strong></p>
            <p>Initial Amount: <strong>${a}</strong></p>
            <p>Growth Rate: <strong>${rateText}</strong> every ${s.tUnit}.</p>
            <p>Find the amount after <strong>${x} ${s.tUnit}</strong>.</p>
            <p><small>(Round to nearest whole number)</small></p>
        `;
        currentQuestion = { answer: ans, type: 'money' }; // Use money logic for int rounding
    }

    // --- 3. Decay (Multiple Scenarios) ---
    function genDecay(qArea) {
        const scenarios = [
            { name: "Radioactive Isotope", start: [100, 500], rate: "Half-life (50%)", b: 0.5, unit: "days" },
            { name: "Car Value", start: [20000, 60000], rate: "Depreciates 20%", b: 0.8, unit: "years" },
            { name: "Caffeine in Body", start: [100, 200], rate: "Eliminates 15%", b: 0.85, unit: "hours" },
            { name: "Tennis Tournament", start: [64, 128], rate: "Half eliminated", b: 0.5, unit: "rounds" },
            { name: "Buying Power (Inflation)", start: [100, 1000], rate: "Loses 5% value", b: 0.95, unit: "years" }
        ];

        const s = randChoice(scenarios);
        const a = randInt(s.start[0], s.start[1]);
        const x = randInt(2, 4);

        const ans = a * Math.pow(s.b, x);

        qArea.innerHTML = `
            <p><strong>Scenario: ${s.name}</strong></p>
            <p>Start Value: <strong>${a}</strong></p>
            <p>Rate: <strong>${s.rate}</strong> per ${s.unit}.</p>
            <p>Find the value after <strong>${x} ${s.unit}</strong>.</p>
            <p><small>(Round to nearest whole number)</small></p>
        `;
        currentQuestion = { answer: ans, type: 'money' };
    }

    // --- 4. Compound Interest (Varied Rates) ---
    function genCompound(qArea) {
        // A = P(1+i)^n
        const P = randInt(1, 50) * 500; // 500 to 25000
        const rate = randInt(2, 12); // percent
        const n = randInt(3, 20); // years
        
        const i = rate / 100;
        const ans = P * Math.pow(1 + i, n);

        qArea.innerHTML = `
            <p>Principal: <strong>$${P}</strong></p>
            <p>Interest Rate: <strong>${rate}%</strong> (compounded annually)</p>
            <p>Time: <strong>${n} years</strong></p>
            <p>Calculate the Final Amount (A).</p>
            <p>Formula: <span class="math-text">A = P(1+i)<sup>n</sup></span></p>
        `;
        currentQuestion = { answer: ans, type: 'money' };
    }

    // --- 5. Rule of 72 (Infinite) ---
    function genRule72(qArea) {
        // Can ask for Time OR Rate
        const mode = Math.random() > 0.5 ? 'time' : 'rate';
        const vals = [2, 3, 4, 6, 8, 9, 12, 18, 24, 36]; // Clean divisors
        const val = randChoice(vals);
        const other = 72 / val;

        if (mode === 'time') {
            qArea.innerHTML = `
                <p>Investment Rate: <strong>${val}%</strong> per year.</p>
                <p>Using Rule of 72, how many <strong>years</strong> to double?</p>
            `;
            currentQuestion = { answer: other, type: 'numeric' };
        } else {
            qArea.innerHTML = `
                <p>You want your money to double in <strong>${val} years</strong>.</p>
                <p>Using Rule of 72, what <strong>interest rate (%)</strong> do you need?</p>
            `;
            currentQuestion = { answer: other, type: 'numeric' };
        }
    }

    // --- 6. Word Problems (Complex) ---
    function genWordProblem(qArea) {
        const type = randInt(1, 3);
        
        if (type === 1) { // Comparison
            const P = 1000;
            const r1 = 5, r2 = 10;
            const t = 10;
            const ans = (P * Math.pow(1.10, t)) - (P * Math.pow(1.05, t));
            qArea.innerHTML = `
                <p>You invest $1000 in Fund A (5%) and $1000 in Fund B (10%).</p>
                <p>After 10 years, how much <strong>MORE</strong> money is in Fund B?</p>
                <p><small>(Find A for both, subtract A - B)</small></p>
            `;
            currentQuestion = { answer: ans, type: 'money' };
        } else if (type === 2) { // Depreciation Target
            const P = 20000;
            const r = 0.5; // Half life
            const t = 3;
            const ans = P * Math.pow(0.5, 3);
            qArea.innerHTML = `
                <p>A piece of machinery costs $20,000. Its value is cut in half every 5 years.</p>
                <p>After <strong>3 half-life cycles</strong> (15 years), what is it worth?</p>
            `;
            currentQuestion = { answer: ans, type: 'money' };
        } else { // Penny Doubling
            const days = randInt(15, 25);
            const ans = 0.01 * Math.pow(2, days - 1);
            qArea.innerHTML = `
                <p>A magic penny doubles in value every day.</p>
                <p>Day 1 = $0.01. Day 2 = $0.02.</p>
                <p>What is its value on <strong>Day ${days}</strong>?</p>
            `;
            currentQuestion = { answer: ans, type: 'money' };
        }
    }

    // --- Check Answer (Smart Logic Updated) ---
    function checkAnswer() {
        if (!currentQuestion) return;
        
        // Anti-Spam: Stop if already solved
        if (isQuestionSolved) return;
        
        let userRaw = document.getElementById('user-answer').value.replace(/[\$,]/g, '').trim();
        let userVal = parseFloat(userRaw);
        let feedback = document.getElementById('feedback-area');
        
        // Attempt numeric parsing logic
        let isCorrect = false;
        let ansNum = parseFloat(currentQuestion.answer);

        if (!isNaN(userVal) && !isNaN(ansNum)) {
             // 0.01 Precision for Numbers/Money
             if (Math.abs(userVal - ansNum) <= 0.01) {
                 isCorrect = true;
             }
        } else {
            // String comparison (just in case future mixed types appear)
            let cleanUser = userRaw.toLowerCase().replace(/\s/g, '');
            let cleanAns = currentQuestion.answer.toString().toLowerCase().replace(/\s/g, '');
            if (cleanUser === cleanAns) {
                isCorrect = true;
            }
        }

        if (isCorrect) {
            feedback.innerHTML = "Correct!";
            feedback.className = "correct";
            isQuestionSolved = true; // Lock
            currentScore++;
            document.getElementById('score-display').innerText = currentScore;
        } else {
            feedback.innerHTML = "Incorrect. Try again.";
            feedback.className = "incorrect";
        }
    }

    // Init
    generateQuestion();

</script>
</body>
</html>
